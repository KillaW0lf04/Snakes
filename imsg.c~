#include "imsg.h"
#include "netutil.h"

#include <sys/ipc.h>
#include <sys/shm.h>
#include <sys/types.h>

int imsgget( key_t key, int flag, struct broker_location *brokers, int no_addresses )
{
	int shmid = shmget( key, sizeof(int) + sizeof( broker_location ) * no_addresses , flag | 0666 );

	if( shmid == -1 )
		return -1;

	void *shmptr = shmat( shmid, 0, 0 );

	if( shmptr == NULL )
		return -1;

	int *no_brokers = (int *) shmptr;
	*nobrokers = no_addresses;

	struct broker_location *location = (struct broker_location *) shmptr + sizeof( int );
	strncpy( location, brokers, sizeof( struct broker_location ) * no_addresses );
}
